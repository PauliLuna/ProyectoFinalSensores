<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel General</title>
    <link rel="stylesheet" href="styles/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</head>

<style>
  body {
    font-family: 'Poppins', sans-serif;
    background-color:#F1FAFB;
  }
</style>


<body class="body-loading"> 
    <script src='https://cdn.jotfor.ms/agent/embedjs/019815e01bf27cb087f8aa913c6a0b409237/embed.js?skipWelcome=1&maximizable=1'></script> <!--Chatbot -->
    <!-- Left and Top menu -->
    <div id="sidebar-container"></div>
    <div id="top-banner-container"></div>

    

    <!-- Main Content -->
    <div class="main-content">

      <!-- Título centrado -->
      <h1 class="centered-title" style="margin-top: 30px;">Executive Dashboard</h1>

      <!-- Filtros y KPIs -->
      <div class="filterContainer" style="margin-bottom: 30px;">
          <!-- KPIs alineados al centro -->
          <div class="kpi-cards alertas" id="kpi-cards-container" style="margin: 0 auto;">
              <div class="kpi-card resumen kpi-home" style="min-width: 220px;">
                  <p id="total-sensores" class="kpi-alerta-numero"></p>
                  <div class="kpi-alerta-texto">
                      <h3>Total Sensores Instalados</h3>
                      <span class="alias-tooltip-icon" tabindex="0" style="margin-left: 4px; position: relative; z-index: 100;">
                          <img src="assets/informacion.png" alt="info" style="width: 16px; height: 16px;">
                          <span class="alias-tooltip-text">
                              <span class="alias-tooltip-arrow"></span>
                              Cantidad total de sensores registrados en la empresa.
                          </span>
                      </span>
                  </div>
              </div>
              <div class="kpi-card success kpi-home" style="min-width: 220px;">
                  <p id="sensores-en-rango" class="kpi-alerta-numero"></p>
                  <div class="kpi-alerta-texto">
                      <h3>Sensores en Rango</h3>
                      <span id="porcentaje-en-rango" class="legend-pct"></span>
                      <span class="alias-tooltip-icon" tabindex="0" style="margin-left: 4px;position: relative;">
                          <img src="assets/informacion.png" alt="info" style="width: 16px; height: 16px;">
                          <span class="alias-tooltip-text">
                              <span class="alias-tooltip-arrow"></span>
                              Porcentaje de sensores que actualmente están dentro de su rango de temperatura.
                          </span>
                      </span>
                  </div>
              </div>
              <div class="kpi-card warning kpi-home" style="min-width: 220px;">
                  <p id="sensores-fuera-rango" class="kpi-alerta-numero"></p>
                  <div class="kpi-alerta-texto">
                      <h3>Sensores Fuera de Rango</h3>
                      <span id="porcentaje-fuera-rango" class="legend-pct"></span>
                      <span class="alias-tooltip-icon" tabindex="0" style="margin-left: 4px;position: relative;">
                          <img src="assets/informacion.png" alt="info" style="width: 16px; height: 16px;">
                          <span class="alias-tooltip-text">
                              <span class="alias-tooltip-arrow"></span>
                              Porcentaje de sensores que actualmente están fuera de su rango de temperatura.
                          </span>
                      </span>
                  </div>
              </div>
              <div class="kpi-card offline kpi-home" style="min-width: 220px;">
                  <p id="sensores-fallo" class="kpi-alerta-numero"></p>
                  <div class="kpi-alerta-texto">
                      <h3>Sensores sin Señal (offline)</h3>
                      <span id="porcentaje-retraso-envio" class="legend-pct"></span>
                      <span class="alias-tooltip-icon" tabindex="0" style="margin-left: 4px;position: relative;">
                          <img src="assets/informacion.png" alt="info" style="width: 16px; height: 16px;">
                          <span class="alias-tooltip-text">
                              <span class="alias-tooltip-arrow"></span>
                              Porcentaje de sensores que no han enviado datos en el tiempo esperado (offline).
                          </span>
                      </span>
                  </div>
              </div>
          </div>
          <!-- Filtro global de fecha alineado a la derecha -->
          <div style="margin-left: auto; display: flex; align-items: center; gap: 8px;">
              <label for="periodSelectHome" style="font-size: 1.05rem;">Fecha</label>
              <select id="periodSelectHome">
                  <option value="24h">Últimas 24 hs</option>
                  <option value="7d">Últimos 7 días</option>
                  <option value="30d">Último mes</option>
                  <option value="todos" selected>Todos</option>
              </select>
          </div>
      </div>

      <!-- Todo lo de abajo se filtra por la fecha seleccionada -->
      <div class="row">
          <!-- Columna izquierda: KPIs Operativos, gráficos, etc. -->
          <div class="col-md-6">
              <h5 class="mb-3" style="margin-bottom: 3px !important;">KPIs Seguimiento</h5>

                <div id="chart-tendencia-alertas" class="charts-section" style="margin-bottom: -3px !important;">
                  <div class="chart-container" style="border: 0px;">

                    <!-- Encabezado con título y dropdown alineados -->
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <h5 class="block-title mb-0" style="margin-right: 15px;">Tendencia de Alertas en el Tiempo</h5>
                      <span class="alias-tooltip-icon" tabindex="0" style="margin-left: 4px; position: relative;">
                        <img src="assets/informacion.png" alt="info" style="width: 16px; height: 16px;">
                        <span class="alias-tooltip-text">
                            <span class="alias-tooltip-arrow"></span>
                            Evolución de la cantidad de alertas detectadas en el período seleccionado.
                            </span>
                        </span>
                     <!-- <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="dropdownPeriodoAlertas" data-bs-toggle="dropdown" aria-expanded="false">
                          Últimas 24 hs
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="dropdownPeriodoAlertas">
                          <li><a class="dropdown-item" href="#" data-period="24h">Últimas 24 hs</a></li>
                          <li><a class="dropdown-item" href="#" data-period="7d">Últimos 7 días</a></li>
                          <li><a class="dropdown-item" href="#" data-period="30d">Últimos 30 días</a></li>
                          <li><a class="dropdown-item" href="#" data-period="90d">Últimos 3 meses</a></li>
                        </ul>
                      </div> -->
                    </div>

                    <!-- Gráfico -->
                    <canvas id="alertasTendenciaChart"></canvas>

                  </div>
                </div>

                <!-- Gráfico de Tendencia de Temperatura Promedio -->
                <div id="chart-section" class="charts-section" style=" margin-bottom: -3px !important;" >
                    <div class="chart-container" style="border: 0px">
                        <h5 >Top 3 sucursales con más alertas por criticidad</h5>
                        <canvas id="alertasSucursalesChart"></canvas>
                    </div>
                </div>

          </div>
          <!-- Columna derecha: Alertas, rankings, etc. -->
          <div class="col-md-6">
              <h5 class="mb-3">Alertas y Seguridad</h5>
                <div class="alert-kpi-card">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Alertas de la Empresa</h5>
                        <button class="btn btn-sm btn-outline-light">Ver Reporte</button>
                    </div>
                    <h2 class="mt-3" id="total_alertas"></h2>
                    <span><strong id="porcentajeAlertasMes"> </strong></span>

                    <div class="bar">
                        <div class="critica"></div>
                        <div class="informativa"></div>
                        <div class="preventiva"></div>
                        <div class="seguridad"></div>
                    </div>

                    <div class="legend-alerts">
                        <span class="critica">Críticas <span id="pct-critica" class="legend-pct"></span></span>
                        <span class="informativa">Informativas <span id="pct-informativa" class="legend-pct"></span></span>
                        <span class="preventiva">Preventivas <span id="pct-preventiva" class="legend-pct"></span></span>
                        <span class="seguridad">Seguridad <span id="pct-seguridad" class="legend-pct"></span></span>
                    </div>

                    <div class="mt-4">
                        <div class="d-flex justify-content-between">
                            <span>Tiempo Promedio Fuera de Rango</span>
                            <span><strong>-- min</strong></span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>Tiempo Promedio desde Última Medición</span>
                            <span><strong>-- min</strong></span>
                        </div>
                    </div>
                </div>

                <!-- Ranking Sensores con Más Alertas -->
                <div class="ranking-card">
                  <h6>Top 3 Sensores con más Alertas</h6>
                  <table class="ranking-table">
                    <thead>
                      <tr>
                        <th style="width: 20%;">ID Sensor</th>
                        <th>Críticas</th>
                        <th>Informativas</th>
                        <th>Preventivas</th>
                        <th>Total</th>
                      </tr>
                    </thead>
                    <tbody id="ranking-sensores">
                      <!-- Se llena dinámicamente con JS -->
                    </tbody>
                  </table>
                </div>
                
                <!-- Ranking Sensores con Más Tiempo Fuera de Temp. -->
                <div class="ranking-card">
                <h6>Top 3 Sensores con Más Tiempo Fuera de Temp.</h6>
                    <table class="ranking-table">
                        <thead>
                        <tr>
                            <th>Sensor</th>
                            <th>Minutos</th>
                            <th>%</th>
                        </tr>
                        </thead>
                        <tbody>
                            <tr><td>Sensor X</td><td>180</td><td>26.4%</td></tr>
                            <tr><td>Sensor Y</td><td>145</td><td>21.3%</td></tr>
                            <tr><td>Sensor Z</td><td>132</td><td>18.7%</td></tr>
                        </tbody>
                    </table>
              </div>
          </div>
      </div>

        <!-- KPIs de Alertas por sucursal y de usuario -->
      <div class="contenedor-tablas" style="margin-top: 0px !important;">
        <div class="ranking-card tabla-2-3">
            <h6>Top 3 sucursales con más alertas y sus tipos más recurrentes</h6>
            <table class="ranking-table">
                <thead>
                    <tr>
                        <th>Sucursal</th>
                        <th>Tipo de Alerta más Común</th>
                        <th>Criticidad</th>
                    </tr>
                </thead>
                <tbody id="ranking-alertas-recurrentes-tbody">
                    </tbody>
            </table>
        </div>
        <div class="ranking-card tabla-1-3">
            <h6>Top 3 usuarios con más alertas de seguridad</h6>
            <table class="ranking-table">
                <thead>
                    <tr>
                        <th>ID Usuario</th>
                        <th style="width: 35%;">Tipo Alerta</th>
                        <th>Cantidad</th>
                    </tr>
                </thead>
                <tbody id="ranking-alertas-seguridad-tbody">
                    </tbody>
            </table>
        </div>

      </div>

      <!-- Uso de la plataforma: Últimas conexiones de usuarios -->
      <div class="recent-activity" style="margin-top: 20px;">
          <h5 style="margin-bottom: 15px;">Últimas Conexiones de Usuarios</h5>
          <div class="table-wrapper" style="position: relative; min-height: 340px; max-height: 340px; overflow-y: auto; padding-bottom: 10px;">
              <table>
                  <thead>
                      <tr>
                          <th>Username</th>
                          <th>Email</th>
                          <th id="th-fecha" style="position:relative;">
                              <span id="fecha-sort-label" style="cursor:pointer; text-align:right;">Fecha</span>
                              <button class="accordion-button" id="fechaAccordionBtn" type="button" aria-expanded="false" aria-controls="collapseFecha" style="position: absolute; right: 0; transform:translateY(20%); display:inline-block; width:auto; background:none; border:none; box-shadow:none; padding:0 8px; font-size:1.1em; vertical-align:middle; color:#1D3557;">
                                  &#9660;
                              </button>
                              <div id="collapseFecha" class="accordion-collapse collapse" style="position:absolute; right:0; top:100%; min-width:160px; background:#fff; border:1px solid #A8DADC; border-radius:8px; box-shadow:0 4px 10px rgba(0,0,0,0.08); z-index:9999; display:none;">
                                  <a class="dropdown-item" href="#" data-range="hoy">Hoy</a>
                                  <a class="dropdown-item" href="#" data-range="ayer">Ayer</a>
                                  <a class="dropdown-item" href="#" data-range="ultimos7">Últimos 7 días</a>
                                  <a class="dropdown-item" href="#" data-range="ultimos30">Últimos 30 días</a>
                                  <a class="dropdown-item" href="#" data-range="estemes">Este mes</a>
                                  <a class="dropdown-item" href="#" data-range="mespasado">Mes pasado</a>
                                  <a class="dropdown-item" href="#" data-range="todos">Todos</a>
                              </div>
                          </th>
                          <th id="th-estado" style="cursor:pointer;">Estado &#8597;</th>
                      </tr>
                  </thead>
                  <tbody id="user-activity-table">
                      <!-- Aquí se insertarán las filas dinámicamente -->
                  </tbody>
              </table>
              <div class="table-pagination-row">
                  <div class="pagination-info">
                      Mostrando <span id="current-results-showing">0</span> de <span id="total-results">0</span> resultados
                  </div>
                  <ul class="pagination" id="user-table-pagination">
                      <!-- Las páginas se generan dinámicamente -->
                  </ul>
              </div>
          </div>
    
        </div>

  

    </div>
    <!-- Scripts para KPIs y gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="scripts/utils.js"></script>
    <script src="scripts/home.js"></script>

   
</body>
</html>